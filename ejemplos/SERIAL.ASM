Include<P16F873.INC>   
LIST P=16F873, R=HEX

S0__	EQU	021H
S1__	EQU	022H
caracter_	EQU	023H
TRANS	EQU	024H
R0D	EQU	025H
R0E	EQU	026H
R14	EQU	027H
R1B	EQU	028H
LOOPS	EQU	029H
LOOPS2	EQU	02AH
CONTA	EQU	02BH
REG	EQU	02CH
RECEP	EQU	02DH
__dato_	EQU	02EH

;--VARIABLES-------------------

	ORG	0
	MOVLW	00H
	MOVWF	caracter_


PTOA		EQU		5H		
PTOB		EQU		6H
TX		EQU		7H
RX		EQU		6H


	GOTO	_PPAL
;--FUNCIONES-------------------

	CLRW

inic_serial_pic_:


	BSF	STATUS,RP0
	MOVLW	00H
	MOVWF	TRISA
	MOVLW	7FH
	MOVWF	TRISB
	BCF	STATUS,RP0
	BSF	PTOB,TX
	CLRF	CONTA

	MOVLW	01H
	RETURN

	RETURN
enviar_serial_:
	MOVF	__dato_,0
	MOVWF	TRANS


	MOVWF	TRANS		;RUTINA PARA ENVIAR ENVIA LO QUE HAY EN TRANS
XMRT	MOVLW	8
	MOVWF	R0D
	BCF	PTOB,TX
	CALL	DELAY1
XNEXT	BCF	PTOB,TX
	BCF	STATUS,C
	RRF	TRANS
	BTFSC	STATUS,C
	BSF	PTOB,TX
	CALL	DELAY1
	DECFSZ	R0D
	GOTO	XNEXT
	BSF	PTOB,TX
	CALL	DELAY1
	RETLW	0

	RETURN
recibir_serial_:


RECIBIR		NOP			;RUTINA PARA RECIBIR, RECIBE EN EL REGISTRO RECEP 
		CLRF	RECEP
		BTFSC	PTOB,RX
		GOTO	RECIBIR
		CALL	UNOYMED
RCVR		MOVLW	8
		MOVWF	CONTA
RNEXT		BCF	STATUS,C
		BTFSC	PTOB,RX
		BSF	STATUS,C
		RRF	RECEP
		CALL	DELAY1
		DECFSZ	CONTA
		GOTO	RNEXT
		MOVF	RECEP,W
		RETURN

	RETURN
_retardo___:


UNOYMED		MOVLW	.249		;RETARDO PARA 1200 BAUDIOS, ALTERE 249 y 166 
		GOTO	STARTUP		;PARA OTRAS VELOCIDADES 
DELAY1		MOVLW	.166
STARTUP		MOVWF	R0E
REDO		NOP
		NOP
		DECFSZ	R0E
		GOTO	REDO
		RETLW	0

	RETURN

;--PRINCIPAL--------------------

_PPAL	CLRW

	CALL	inic_serial_pic_
_WHL0:
	MOVLW	064H
	MOVWF	S1__
	MOVF	caracter_,0
	SUBWF	S1__,0
	BTFSS	STATUS,0
	GOTO	_ELS0
	CALL	recibir_serial_
	MOVWF	caracter_
	MOVF	caracter_,0
	MOVWF	__dato_
	CALL	enviar_serial_
	GOTO	_WHL0
_ELS0:

	SLEEP

	END
;------------------------------


